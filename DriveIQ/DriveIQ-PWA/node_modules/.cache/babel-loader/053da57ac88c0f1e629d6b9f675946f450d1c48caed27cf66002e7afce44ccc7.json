{"ast":null,"code":"import api from './api'; // Axios instance\n\n// Helper to send a batch of GPS data to the backend\nconst sendGPSBatchToBackend = async (batch, driverId) => {\n  try {\n    const token = localStorage.getItem('token'); // Get JWT token\n    if (!token) {\n      console.error('No token found');\n      return;\n    }\n    const response = await api.post('/record-telematics', {\n      driver_id: driverId,\n      gps_data: batch // Send the batch data\n    }, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    if (response.status === 200) {\n      console.log('Batch successfully sent:', response.data);\n    } else {\n      console.error('Error sending GPS data. Response:', response);\n    }\n  } catch (error) {\n    console.error('Error sending GPS data:', error.response || error.message || error);\n  }\n};\n\n// Function to generate random time steps between 60 and 180 seconds\nconst generateRandomTimeStep = () => {\n  return Math.floor(Math.random() * (180 - 60 + 1)) + 60; // 1 to 3 minutes per step\n};\n\n// Function to generate random lat/long points near a base point with controlled offsets\nconst generateRandomLatLng = (baseLat, baseLng, distance = 0.0005) => {\n  const randomOffset = () => (Math.random() - 0.5) * distance; // Generate small random offset for lat/lng\n  return {\n    Latitude: baseLat + randomOffset(),\n    Longitude: baseLng + randomOffset()\n  };\n};\n\n// Helper function to simulate speed depending on the type of area\nconst simulateSpeed = isSensitiveArea => {\n  if (isSensitiveArea) {\n    return Math.random() * (30 - 10) + 10; // Simulate 10-30 km/h for sensitive areas\n  }\n  return Math.random() * (70 - 30) + 30; // Simulate 30-70 km/h in regular areas\n};\n\n// ** Mock GPS Generation: Create 5-6 Batches per Day **\nexport const mockGPSData = async (setGpsData, driverId) => {\n  const basePoints = [{\n    Latitude: 26.6338,\n    Longitude: 92.8006\n  },\n  // Point A (Home)\n  {\n    Latitude: 26.6382,\n    Longitude: 92.8074\n  },\n  // Point B (Office)\n  {\n    Latitude: 26.6451,\n    Longitude: 92.8185\n  },\n  // Point C (Market)\n  {\n    Latitude: 26.6492,\n    Longitude: 92.8220\n  } // Point D (Pharmacy)\n  ];\n  const totalBatches = 5; // Total of 5 batches for the day\n\n  for (let batchIndex = 0; batchIndex < totalBatches; batchIndex++) {\n    let batch = [];\n\n    // Generate random points for each batch (could have 8-10 points per batch)\n    for (let i = 0; i < basePoints.length; i++) {\n      const nextPoint = basePoints[(i + 1) % basePoints.length]; // Loop back to A after D\n      const currentPoint = basePoints[i];\n      let timeStep = generateRandomTimeStep();\n\n      // Generate 3-5 random points between each major stop\n      for (let j = 0; j < 3; j++) {\n        const randomLatLng = generateRandomLatLng(currentPoint.Latitude, currentPoint.Longitude);\n        const isSensitiveArea = Math.random() < 0.2; // 20% chance of being near a sensitive area\n        const speed = simulateSpeed(isSensitiveArea); // Simulate speed based on area type\n\n        // Ensure valid timeStep and speed before adding to the journey\n        if (speed > 0 && timeStep > 0 && speed <= 70) {\n          // Cap speed at 70 km/h\n          batch.push({\n            ...randomLatLng,\n            Time_Step: timeStep,\n            Speed: speed\n          });\n          setGpsData(prev => [...prev, {\n            ...randomLatLng,\n            Time_Step: timeStep,\n            Speed: speed\n          }]);\n        }\n        timeStep += generateRandomTimeStep(); // Increment the time step for the next point\n      }\n\n      // Add the final point at the destination (B, C, D, A)\n      const speed = simulateSpeed(false); // Regular area speed for major stops\n      if (speed > 0 && timeStep > 0 && speed <= 70) {\n        batch.push({\n          ...nextPoint,\n          Time_Step: timeStep,\n          Speed: speed\n        });\n        setGpsData(prev => [...prev, {\n          ...nextPoint,\n          Time_Step: timeStep,\n          Speed: speed\n        }]);\n      }\n    }\n\n    // Send the batch after collecting all points for the journey\n    await sendGPSBatchToBackend(batch, driverId);\n\n    // Simulate delay between batches (e.g., simulate multiple batches throughout the day)\n    await new Promise(resolve => setTimeout(resolve, 5000)); // Simulate delay between batches (5 seconds for testing)\n  }\n};\n\n// Helper function to calculate distance between two GPS points (in meters)\nconst calculateDistance = (point1, point2) => {\n  const R = 6371e3; // Radius of the earth in meters\n  const lat1 = point1.Latitude * Math.PI / 180;\n  const lat2 = point2.Latitude * Math.PI / 180;\n  const deltaLat = (point2.Latitude - point1.Latitude) * Math.PI / 180;\n  const deltaLon = (point2.Longitude - point1.Longitude) * Math.PI / 180;\n  const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) + Math.cos(lat1) * Math.cos(lat2) * Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c; // Returns the distance in meters\n};\n\n// Helper function to calculate speed in km/h between two GPS points based on distance and time step\nconst calculateSpeed = (point1, point2, timeStep) => {\n  if (timeStep === 0) return NaN; // Avoid division by zero\n\n  const distance = calculateDistance(point1, point2); // Distance in meters\n  let speed = distance / timeStep * 3.6; // Convert m/s to km/h\n\n  // Cap the speed to a realistic value (e.g., max 70 km/h)\n  if (speed > 70) {\n    speed = 70;\n  }\n  return speed;\n};","map":{"version":3,"names":["api","sendGPSBatchToBackend","batch","driverId","token","localStorage","getItem","console","error","response","post","driver_id","gps_data","headers","Authorization","status","log","data","message","generateRandomTimeStep","Math","floor","random","generateRandomLatLng","baseLat","baseLng","distance","randomOffset","Latitude","Longitude","simulateSpeed","isSensitiveArea","mockGPSData","setGpsData","basePoints","totalBatches","batchIndex","i","length","nextPoint","currentPoint","timeStep","j","randomLatLng","speed","push","Time_Step","Speed","prev","Promise","resolve","setTimeout","calculateDistance","point1","point2","R","lat1","PI","lat2","deltaLat","deltaLon","a","sin","cos","c","atan2","sqrt","calculateSpeed","NaN"],"sources":["C:/Users/anush/OneDrive/Desktop/minor project/DriveIQ/DriveIQ/DriveIQ-PWA/src/utils/geolocation.js"],"sourcesContent":["import api from './api';  // Axios instance\r\n\r\n// Helper to send a batch of GPS data to the backend\r\nconst sendGPSBatchToBackend = async (batch, driverId) => {\r\n  try {\r\n    const token = localStorage.getItem('token');  // Get JWT token\r\n    if (!token) {\r\n      console.error('No token found');\r\n      return;\r\n    }\r\n\r\n    const response = await api.post('/record-telematics', {\r\n      driver_id: driverId,\r\n      gps_data: batch,  // Send the batch data\r\n    }, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    });\r\n\r\n    if (response.status === 200) {\r\n      console.log('Batch successfully sent:', response.data);\r\n    } else {\r\n      console.error('Error sending GPS data. Response:', response);\r\n    }\r\n  } catch (error) {\r\n    console.error('Error sending GPS data:', error.response || error.message || error);\r\n  }\r\n};\r\n\r\n// Function to generate random time steps between 60 and 180 seconds\r\nconst generateRandomTimeStep = () => {\r\n  return Math.floor(Math.random() * (180 - 60 + 1)) + 60;  // 1 to 3 minutes per step\r\n};\r\n\r\n// Function to generate random lat/long points near a base point with controlled offsets\r\nconst generateRandomLatLng = (baseLat, baseLng, distance = 0.0005) => {\r\n  const randomOffset = () => (Math.random() - 0.5) * distance;  // Generate small random offset for lat/lng\r\n  return {\r\n    Latitude: baseLat + randomOffset(),\r\n    Longitude: baseLng + randomOffset(),\r\n  };\r\n};\r\n\r\n// Helper function to simulate speed depending on the type of area\r\nconst simulateSpeed = (isSensitiveArea) => {\r\n  if (isSensitiveArea) {\r\n    return Math.random() * (30 - 10) + 10;  // Simulate 10-30 km/h for sensitive areas\r\n  }\r\n  return Math.random() * (70 - 30) + 30;  // Simulate 30-70 km/h in regular areas\r\n};\r\n\r\n// ** Mock GPS Generation: Create 5-6 Batches per Day **\r\nexport const mockGPSData = async (setGpsData, driverId) => {\r\n  const basePoints = [\r\n    { Latitude: 26.6338, Longitude: 92.8006 },  // Point A (Home)\r\n    { Latitude: 26.6382, Longitude: 92.8074 },  // Point B (Office)\r\n    { Latitude: 26.6451, Longitude: 92.8185 },  // Point C (Market)\r\n    { Latitude: 26.6492, Longitude: 92.8220 }   // Point D (Pharmacy)\r\n  ];\r\n\r\n  const totalBatches = 5;  // Total of 5 batches for the day\r\n\r\n  for (let batchIndex = 0; batchIndex < totalBatches; batchIndex++) {\r\n    let batch = [];\r\n\r\n    // Generate random points for each batch (could have 8-10 points per batch)\r\n    for (let i = 0; i < basePoints.length; i++) {\r\n      const nextPoint = basePoints[(i + 1) % basePoints.length];  // Loop back to A after D\r\n      const currentPoint = basePoints[i];\r\n      let timeStep = generateRandomTimeStep();\r\n\r\n      // Generate 3-5 random points between each major stop\r\n      for (let j = 0; j < 3; j++) {\r\n        const randomLatLng = generateRandomLatLng(currentPoint.Latitude, currentPoint.Longitude);\r\n        const isSensitiveArea = Math.random() < 0.2;  // 20% chance of being near a sensitive area\r\n        const speed = simulateSpeed(isSensitiveArea);  // Simulate speed based on area type\r\n\r\n        // Ensure valid timeStep and speed before adding to the journey\r\n        if (speed > 0 && timeStep > 0 && speed <= 70) {  // Cap speed at 70 km/h\r\n          batch.push({ ...randomLatLng, Time_Step: timeStep, Speed: speed });\r\n          setGpsData(prev => [...prev, { ...randomLatLng, Time_Step: timeStep, Speed: speed }]);\r\n        }\r\n\r\n        timeStep += generateRandomTimeStep();  // Increment the time step for the next point\r\n      }\r\n\r\n      // Add the final point at the destination (B, C, D, A)\r\n      const speed = simulateSpeed(false);  // Regular area speed for major stops\r\n      if (speed > 0 && timeStep > 0 && speed <= 70) {\r\n        batch.push({ ...nextPoint, Time_Step: timeStep, Speed: speed });\r\n        setGpsData(prev => [...prev, { ...nextPoint, Time_Step: timeStep, Speed: speed }]);\r\n      }\r\n    }\r\n\r\n    // Send the batch after collecting all points for the journey\r\n    await sendGPSBatchToBackend(batch, driverId);\r\n\r\n    // Simulate delay between batches (e.g., simulate multiple batches throughout the day)\r\n    await new Promise((resolve) => setTimeout(resolve, 5000));  // Simulate delay between batches (5 seconds for testing)\r\n  }\r\n};\r\n\r\n// Helper function to calculate distance between two GPS points (in meters)\r\nconst calculateDistance = (point1, point2) => {\r\n  const R = 6371e3;  // Radius of the earth in meters\r\n  const lat1 = point1.Latitude * Math.PI / 180;\r\n  const lat2 = point2.Latitude * Math.PI / 180;\r\n  const deltaLat = (point2.Latitude - point1.Latitude) * Math.PI / 180;\r\n  const deltaLon = (point2.Longitude - point1.Longitude) * Math.PI / 180;\r\n\r\n  const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\r\n            Math.cos(lat1) * Math.cos(lat2) *\r\n            Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  return R * c;  // Returns the distance in meters\r\n};\r\n\r\n// Helper function to calculate speed in km/h between two GPS points based on distance and time step\r\nconst calculateSpeed = (point1, point2, timeStep) => {\r\n  if (timeStep === 0) return NaN;  // Avoid division by zero\r\n\r\n  const distance = calculateDistance(point1, point2);  // Distance in meters\r\n  let speed = (distance / timeStep) * 3.6;  // Convert m/s to km/h\r\n\r\n  // Cap the speed to a realistic value (e.g., max 70 km/h)\r\n  if (speed > 70) {\r\n    speed = 70;\r\n  }\r\n\r\n  return speed;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}